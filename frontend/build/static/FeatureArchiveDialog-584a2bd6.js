import{c as le,j as a,b as Z,aD as U,aV as ee,d as T,b6 as W,C as R,E as de,T as P,c3 as Re,s as x,fG as De,bc as Fe,fH as te,au as G,X as K,fI as Be,fJ as $e,fK as Pe,fL as Oe,fM as Le,bs as J,fN as qe,i as _e,fO as ze,cf as Ve,fP as Q,r as w,aw as ue,f as I,fQ as ge,ag as he,fR as pe,ax as fe,aW as ye,bm as je,fS as Ie,h as q,dj as Ue,aX as We,aU as me,aE as X,aZ as Se,fT as He,fU as Ye,fV as Me,fW as Je,fX as Ge,fY as Ke,a_ as be,b7 as Ne,fZ as Qe,eJ as ve,B as we,f_ as Xe,y as N,aI as se,ae as Ze,bN as ae,f$ as et,en as tt,g0 as at,g1 as nt,g2 as st,b9 as rt,ba as ot,bb as it,A as Te,l as Ce,bQ as ct,m as lt,o as dt,L as ut,g3 as gt,n as ht,u as pt,bL as ft,aP as yt,aN as mt,aO as St,aJ as bt}from"./index-4f80e427.js";const vt=le(a("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"}),"Cloud"),ia=le(a("path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm4.2 14.2L11 13V7h1.5v5.2l4.5 2.7-.8 1.3z"}),"WatchLater"),ca=({enabled:e,className:n})=>{const t=Z(),o=e?"Environment enabled":"Environment disabled",s={backgroundColor:e?t.palette.primary.light:t.palette.neutral.border,borderRadius:"50%",width:"28px",height:"28px",minWidth:"28px",display:"flex",alignItems:"center",justifyContent:"center",marginRight:t.spacing(1)},r={fill:t.palette.common.white,width:"16px",height:"16px"};return a("div",{style:s,className:n,children:a(vt,{style:r,titleAccess:o})})},wt=({isOpen:e,onConfirm:n,onClose:t,showBanner:o,environment:s,messageComponent:r})=>{const i=U("projectId"),{data:c}=ee(i),{changeRequestInReviewOrApproved:f,alert:p}=Re(c),l=f(s||"");return T(W,{open:e,primaryButtonText:l?"Add to existing change request":"Add suggestion to draft",secondaryButtonText:"Cancel",onClick:n,onClose:t,title:"Request changes",fullWidth:!0,children:[a(R,{condition:l,show:p}),a(R,{condition:!!o,show:T(de,{severity:"info",sx:{mb:2},children:["Change requests feature is enabled for ",s,". Your changes need to be approved before they will be live. All the changes you do now will be added into a draft that you can submit for review."]})}),a(P,{variant:"body2",color:"text.secondary",children:"Your suggestion:"}),r]})},Tt=(e,n)=>{const t={};return n.parameters.forEach(o=>{t[o.name]=Ct(e,o)}),{name:n.name,constraints:[],parameters:t}},Ct=(e,n)=>n.name==="rollout"||n.name==="percentage"||n.type==="percentage"?"50":n.name==="stickiness"?"":n.name==="groupId"?e:n.type==="boolean"?"false":"",xt=x("form")(({theme:e})=>({display:"grid",gap:e.spacing(2)})),re=x("hr")(({theme:e})=>({width:"100%",height:"1px",margin:e.spacing(2,0),border:"none",background:e.palette.background.elevation2})),Et=x("div")(({theme:e})=>({display:"flex",justifyContent:"end",gap:e.spacing(2),paddingBottom:e.spacing(10)})),kt=({projectId:e,environmentId:n,permission:t,onSubmit:o,onCancel:s,loading:r,strategy:i,setStrategy:c,segments:f,setSegments:p,errors:l})=>{var A;const y=De(i.constraints),h=Fe(t,e,n),{strategyDefinition:d}=te(i==null?void 0:i.name),u=G(),{uiConfig:g,error:C,loading:k}=K();if(C)throw C;if(k||!d)return null;const O=S=>d.parameters.find(b=>b.name===S),E=(S,b)=>{const D=O(S);if(S!=="groupId"){const $=ze(D,b);return $?(l.setFormError(S,$),!1):(l.removeFormError(S),!0)}return!0},m=()=>d.parameters.map(S=>S.name).map(S=>{var b;return E(S,(b=i.parameters)==null?void 0:b[S])}).every(Boolean),_=()=>{u(`/projects/${e}/settings/default-strategy`)};return T(xt,{onSubmit:async S=>{if(S.preventDefault(),m())o();else return},children:[a(Be,{title:i.title||"",setTitle:S=>{c(b=>({...b,title:S}))}}),a(R,{condition:!!g.flags.SE,show:a($e,{segments:f,setSegments:p,projectId:e})}),a(Pe,{projectId:e,environmentId:n,strategy:i,setStrategy:c}),a(re,{}),a(Oe,{strategy:i,strategyDefinition:d,setStrategy:c,validateParameter:E,errors:l,hasAccess:h}),a(R,{condition:!!((A=g==null?void 0:g.flags)!=null&&A.strategyVariant)&&i.parameters!=null&&"stickiness"in i.parameters,show:a(Le,{strategy:i,setStrategy:c,environment:n,projectId:e})}),a(re,{}),T(Et,{children:[a(J,{permission:t,projectId:e,environmentId:n,variant:"contained",color:"primary",type:"submit",disabled:r||!y||l.hasFormErrors(),"data-testid":qe,children:"Save strategy"}),a(_e,{type:"button",color:"primary",onClick:s||_,disabled:r,children:"Cancel"})]})]})},xe=(e,n)=>{var i;const{project:t,refetch:o}=Ve(e),s={name:"flexibleRollout",constraints:[],parameters:{rollout:"100",stickiness:t.defaultStickiness||"default",groupId:""}},r=(i=t.environments.find(c=>c.environment===n))==null?void 0:i.defaultStrategy;return{defaultStrategyFallback:s,strategy:r,refetch:o}},la=()=>{const e=U("projectId"),n=Q("environmentId"),{defaultStrategyFallback:t,strategy:o,refetch:s}=xe(e,n),[r,i]=w.useState(o||t),[c,f]=w.useState([]),{updateDefaultStrategy:p,loading:l}=ue(),{strategyDefinition:y}=te(r==null?void 0:r.name),{setToastData:h,setToastApiError:d}=I(),u=ge(),{uiConfig:g}=K(),{unleashUrl:C}=g,k=G(),{trackEvent:O}=he(),{segments:E,refetchSegments:m}=pe();w.useEffect(()=>{if(E&&(o!=null&&o.segments)){const b=[];for(const D of o==null?void 0:o.segments)b.push(...E.filter($=>$.id===D));f(b)}},[JSON.stringify(E),JSON.stringify(o==null?void 0:o.segments)]);const _=g!=null&&g.flags.SE?c:[],B=At(r,_),A=async b=>{await p(e,n,b),O("default_strategy",{props:{action:"edit",hasTitle:!!b.title}}),await m(),h({title:"Default Strategy updated",type:"success",confetti:!0})},S=async()=>{const b=`/projects/${e}/settings/default-strategy`;try{await A(B),await s(),k(b)}catch(D){d(q(D))}};return!y||!r?null:a(fe,{modal:!0,title:ye((r==null?void 0:r.name)??""),description:Dt,documentationLink:Ft,documentationLinkLabel:Bt,formatApiCode:()=>Rt(e,n,B,y,C),children:a(kt,{projectId:e,strategy:r,setStrategy:i,segments:c,setSegments:f,environmentId:n,onSubmit:S,loading:l,permission:je,errors:u,isChangeRequest:!1})})},At=(e,n)=>({name:e.name,title:e.title,constraints:e.constraints??[],parameters:e.parameters??{},variants:e.variants??[],segments:n.map(t=>t.id),disabled:e.disabled??!1}),Rt=(e,n,t,o,s)=>{if(!s)return"";const r={...t,parameters:Ie(t.parameters??{},o)},i=`${s}/api/admin/projects/${e}/environments/${n}/default-strategy}`,c=JSON.stringify(r,void 0,2);return`curl --location --request PUT '${i}' \\
    --header 'Authorization: INSERT_API_KEY' \\
    --header 'Content-Type: application/json' \\
    --data-raw '${c}'`},Dt=`
    An activation strategy will only run when a feature toggle is enabled and provides a way to control who will get access to the feature.
    If any of a feature toggle's activation strategies returns true, the user will get access.
`,Ft="https://docs.getunleash.io/reference/activation-strategies",Bt="Default strategy documentation",da=()=>{const e=U("projectId"),n=U("featureId"),t=Q("environmentId"),o=Q("strategyName"),{strategy:s,defaultStrategyFallback:r}=xe(e,t),i=JSON.parse(Ue().get("defaultStrategy")||"false"),{segments:c}=pe(),f=(c||[]).filter(F=>{var V;return(V=s==null?void 0:s.segments)==null?void 0:V.includes(F.id)}),[p,l]=w.useState({}),[y,h]=w.useState(i?f:[]),{strategyDefinition:d}=te(o),u=ge(),{addStrategyToFeature:g,loading:C}=We(),{addChange:k}=me(),{setToastData:O,setToastApiError:E}=I(),{uiConfig:m}=K(),{unleashUrl:_}=m,B=G(),{feature:A,refetchFeature:S}=X(e,n),b=w.useRef(A),{isChangeRequestConfigured:D}=Se(e),{refetch:$}=ee(e),{trackEvent:H}=he(),{data:j,staleDataNotification:v,forceRefreshCache:L}=He({unleashGetter:X,params:[e,n],dataKey:"feature",refetchFunctionKey:"refetchFeature",options:{}},A,{afterSubmitAction:S},Qe);w.useEffect(()=>{b.current.name===""&&A.name&&(L(A),b.current=A)},[A.name]),w.useEffect(()=>{var F;if(i){const V=s||r;((F=V.parameters)==null?void 0:F.groupId)===""&&n?l({...V,parameters:{...V.parameters,groupId:n}}):l(V)}else d&&l(Tt(n,d))},[n,JSON.stringify(d),i]);const Y=async F=>{await g(e,n,t,F),O({title:"Strategy created",type:"success",confetti:!0})},M=async F=>{await k(e,t,{action:"addStrategy",feature:n,payload:F}),O({title:"Strategy added to draft",type:"success",confetti:!0}),$()},z=Ye(p,y),Ae=async()=>{H("strategyTitle",{props:{hasTitle:!!p.title,on:"create"}});try{D(t)?await M(z):await Y(z),S(),B(Ne(e,n))}catch(F){E(q(F))}};return!j||!j.project?null:T(fe,{modal:!0,title:ye(o),description:Me,documentationLink:Je,documentationLinkLabel:Ge,formatApiCode:()=>Pt(e,n,t,z,_),children:[a(Ke,{projectId:e,feature:j,strategy:p,setStrategy:l,segments:y,setSegments:h,environmentId:t,onSubmit:Ae,loading:C,permission:be,errors:u,isChangeRequest:D(t)}),v]})},$t=(e,n,t,o,s=!1)=>{const r=new URLSearchParams({environmentId:t,strategyName:o,defaultStrategy:String(s)});return`/projects/${e}/features/${n}/strategies/create?${r}`},Pt=(e,n,t,o,s)=>{if(!s)return"";const r=`${s}/api/admin/projects/${e}/features/${n}/environments/${t}/strategies`,i=JSON.stringify(o,void 0,2);return`curl --location --request POST '${r}' \\
    --header 'Authorization: INSERT_API_KEY' \\
    --header 'Content-Type: application/json' \\
    --data-raw '${i}'`},Ee=()=>{const e=Z();return n=>{switch(n){case"second":case"minute":case"hour":case"day":return[e.palette.seen.recent,e.palette.success.main];case"week":return[e.palette.seen.inactive,e.palette.warning.main];case"month":case"year":return[e.palette.seen.abandoned,e.palette.error.main];default:return[e.palette.seen.unknown,e.palette.grey.A400]}}},Ot=x("div",{})(({theme:e})=>({width:"100%",maxWidth:e.spacing(50),padding:e.spacing(1),backgroundColor:e.palette.background.paper,color:e.palette.text.secondary,fontSize:e.fontSizes.smallBody,borderRadius:e.shape.borderRadiusMedium})),Lt=x("div")({display:"flex",flexDirection:"row"}),qt=x("p")(({theme:e})=>({color:e.palette.text.primary,fontSize:e.fontSizes.smallBody,fontWeight:e.fontWeight.bold,marginBottom:e.spacing(1)})),_t=x("p")(({theme:e})=>({color:e.palette.text.primary,fontSize:e.fontSizes.smallBody,fontWeight:e.fontWeight.bold,marginBottom:e.spacing(1),width:"50%"})),zt=x("p")(({theme:e})=>({fontSize:e.fontSizes.smallBody,margin:e.spacing(2,0)})),Vt=x("div")({width:"50%"}),oe=x("div",{shouldForwardProp:e=>e!=="color"})(({color:e})=>({textAlign:"left",width:"100%",color:e})),jt=({environments:e,...n})=>{const t=Ee(),[,o]=t();return T(Ot,{...n,children:[a(qt,{sx:{mb:0},children:"Last usage reported"}),a(zt,{children:"Usage is reported from connected applications through metrics"}),e&&e.map(({name:s,lastSeenAt:r})=>T(Lt,{children:[a(_t,{children:s}),a(Vt,{children:a(R,{condition:!!r,show:a(ve,{date:r,title:"",live:!1,formatter:(i,c,f)=>{const[,p]=t(c);return a(oe,{color:p,children:`${i} ${c}${i!==1?"s":""} ${f}`})}}),elseShow:a(oe,{color:o,children:"no usage"})})})]},s))]})},It=e=>w.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"current",xmlns:"http://www.w3.org/2000/svg",...e},w.createElement("path",{d:"M7 10H13",stroke:"#6E6E70",strokeWidth:1.75,strokeLinecap:"round",strokeLinejoin:"round"})),Ut=e=>w.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},w.createElement("path",{d:"M15 10H12.8571L11.4286 14L8.57143 6L7.14286 10H5",stroke:"current",strokeWidth:1.75,strokeLinecap:"round",strokeLinejoin:"round"})),Wt=x("div")(({theme:e})=>({display:"flex",padding:e.spacing(1.5)})),Ht=x(we)(({theme:e})=>({width:"28px",height:"28px",background:"transparent",borderRadius:`${e.shape.borderRadius}px`,textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",fontSize:e.typography.body2.fontSize,margin:"0 auto"})),Yt=x("div")(({theme:e})=>({width:"20px",height:"20px",background:e.palette.background.paper,borderRadius:`${e.shape.borderRadius}px`,textAlign:"center",display:"flex",alignItems:"center",justifyContent:"center",fontSize:e.typography.body2.fontSize,margin:"0 auto"})),ie=({sx:e,tooltip:n,color:t,children:o})=>a(Wt,{sx:e,children:a(Xe,{variant:"custom",titleComponent:n,arrow:!0,describeChild:!0,children:a(Ht,{sx:{"&:hover":{background:t}},children:a(Yt,{style:{background:t},children:o})})})}),ua=({featureLastSeen:e,environments:n,sx:t})=>{const o=Ee();return a(R,{condition:!!e,show:e&&a(ve,{date:e,title:"",live:!1,formatter:(s,r)=>{const[i,c]=o(r);return a(ie,{sx:t,tooltip:a(jt,{environments:n}),color:i,children:a(Ut,{stroke:c})})}}),elseShow:a(ie,{tooltip:"No usage reported from connected applications",children:a(It,{})})})},ce=x("p")(({theme:e})=>({marginBottom:e.spacing(.5),fontSize:e.fontSizes.bodySize})),ga=({open:e,environmentName:n,featureId:t,projectId:o,onClose:s})=>{const r=G(),i=$t(o,t,n,"default");return T(W,{open:e,maxWidth:"sm",onClose:()=>s(),title:"You need to add a strategy to your toggle",primaryButtonText:"Take me directly to add strategy",permissionButton:a(J,{type:"button",permission:be,projectId:o,environmentId:n,onClick:()=>{s(),r(i)},children:"Take me directly to add strategy"}),secondaryButtonText:"Cancel",children:[a(ce,{children:"Before you can enable the toggle in the environment, you need to add an activation strategy."}),a(ce,{children:"You can add the activation strategy by selecting the toggle, open the environment accordion and add the activation strategy."})]})},Mt="You can not enable the environment before it has strategies",Jt=e=>{const{setToastData:n,setToastApiError:t}=I(),{addChange:o}=me(),{refetch:s}=ee(e),[r,i]=w.useState({isOpen:!1}),c=w.useCallback((l,y,h,d)=>{i({featureName:l,environment:y,enabled:h,shouldActivateDisabledStrategies:d,isOpen:!0})},[]),f=w.useCallback(()=>{i(l=>({...l,isOpen:!1}))},[]),p=w.useCallback(async()=>{try{await o(e,r.environment,{feature:r.featureName,action:"updateEnabled",payload:{enabled:!!r.enabled,shouldActivateDisabledStrategies:!!r.shouldActivateDisabledStrategies}}),s(),i(l=>({...l,isOpen:!1})),n({type:"success",title:"Changes added to the draft!"})}catch(l){t(q(l)),i(y=>({...y,isOpen:!1}))}},[o]);return{onChangeRequestToggle:c,onChangeRequestToggleClose:f,onChangeRequestToggleConfirm:p,changeRequestDialogDetails:r}},Gt=({isOpen:e,onAddDefaultStrategy:n,onActivateDisabledStrategies:t,onClose:o,environment:s,disabledStrategiesCount:r=0})=>{const i=U("projectId");return T(W,{open:e,secondaryButtonText:"Cancel",permissionButton:T(N,{children:[a(J,{type:"button",permission:se,projectId:i,environmentId:s,onClick:n,children:"Add default strategy"}),a(J,{type:"button",variant:"text",permission:se,projectId:i,environmentId:s,onClick:t,children:"Enable all strategies"})]}),onClose:o,title:"Enable feature toggle",fullWidth:!0,children:[T(P,{variant:"body1",color:"text.primary",sx:{mb:c=>c.spacing(2)},children:["The feature toggle has ",r," disabled",r===1?" strategy":" strategies","."]}),a(P,{variant:"body1",color:"text.primary",children:"You can choose to enable all the disabled strategies or you can add the default strategy to enable this feature toggle."})]})},Kt=({enabled:e,featureName:n,environment:t})=>T(P,{"data-testid":"update-enabled-message",children:[a("strong",{children:e?"Enable":"Disable"})," feature toggle"," ",a("strong",{children:n})," in ",a("strong",{children:t})]}),Nt=x(we)(()=>({mx:"auto",...Ze})),ha=({projectId:e,featureId:n,environmentName:t,value:o,onToggle:s,onError:r})=>{var j;const{toggleFeatureEnvironmentOn:i,toggleFeatureEnvironmentOff:c}=ae(),{setToastData:f,setToastApiError:p}=I(),{isChangeRequestConfigured:l}=Se(e),{onChangeRequestToggle:y,onChangeRequestToggleClose:h,onChangeRequestToggleConfirm:d,changeRequestDialogDetails:u}=Jt(e),[g,C,k]=et(o),[O,E]=w.useState(!1),{feature:m}=X(e,n),_=((j=m==null?void 0:m.environments.find(v=>v.name===t))==null?void 0:j.strategies.filter(v=>v.disabled).length)??0,B=async(v=!1)=>{try{C(!g),await i(e,m.name,t,v),f({type:"success",title:`Available in ${t}`,text:`${m.name} is now available in ${t} based on its defined strategies.`}),s==null||s(e,m.name,t,!g)}catch(L){L instanceof Error&&L.message===Mt?r==null||r():p(q(L)),k()}},A=async()=>{try{C(!g),await c(e,m.name,t),f({type:"success",title:`Unavailable in ${t}`,text:`${m.name} is unavailable in ${t} and its strategies will no longer have any effect.`}),s==null||s(e,m.name,t,!g)}catch(v){p(q(v)),k()}},S=async v=>{if(l(t)){v.preventDefault(),$()?E(!0):y(m.name,t,!g,!1);return}if(g){await A();return}$()?E(!0):await B()},b=async()=>{l(t)?y(m.name,t,!g,!0):await B(!0),E(!1)},D=async()=>{l(t)?y(m.name,t,!g,!1):await B(),E(!1)},$=()=>{var L,Y,M;const v=(L=m==null?void 0:m.environments)==null?void 0:L.find(z=>z.name===t);return(v==null?void 0:v.strategies)&&((Y=v==null?void 0:v.strategies)==null?void 0:Y.length)>0&&((M=v==null?void 0:v.strategies)==null?void 0:M.every(z=>z.disabled))},H=`${m.name}-${t}`;return T(N,{children:[a(Nt,{"data-testid":`TOGGLE-${H}`,children:a(tt,{tooltip:g?`Disable feature in ${t}`:`Enable feature in ${t}`,checked:g,environmentId:t,projectId:e,permission:at,inputProps:{"aria-label":t},onClick:S})},H),a(Gt,{isOpen:O,onClose:()=>E(!1),environment:t,disabledStrategiesCount:_,onActivateDisabledStrategies:b,onAddDefaultStrategy:D}),a(wt,{isOpen:u.isOpen,onClose:h,environment:u==null?void 0:u.environment,onConfirm:d,messageComponent:a(Kt,{enabled:u==null?void 0:u.enabled,featureName:u==null?void 0:u.featureName,environment:u.environment})})]})},Qt=x(nt)(({theme:e})=>({color:e.palette.warning.main,fontSize:e.fontSizes.bodySize})),pa=()=>a(st,{arrow:!0,title:T(N,{children:["This environment has no variants enabled. If you check this feature's variants in this environment, you will get the"," ",a("a",{href:"https://docs.getunleash.io/reference/feature-toggle-variants#the-disabled-variant",target:"_blank",rel:"noreferrer",children:"disabled variant"}),"."]}),children:a(Qt,{})});var ne={},Xt=ot;Object.defineProperty(ne,"__esModule",{value:!0});var ke=ne.default=void 0,Zt=Xt(rt()),ea=it,ta=(0,Zt.default)((0,ea.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");ke=ne.default=ta;const aa=gt(),fa=({options:e,selectedOptions:n,indeterminateOptions:t,tagType:o,existingTags:s,disabled:r=!1,onChange:i})=>{const c=a(ht,{fontSize:"small"});return a(Te,{multiple:!0,id:"checkboxes-tag",sx:{marginTop:h=>h.spacing(2),width:500},disableCloseOnSelect:!0,placeholder:"Select Values",options:e,value:n,renderTags:(h,d)=>h.map((u,g)=>s.some(k=>k.value===u.title&&k.type===o.name)&&t===void 0?null:a(ut,{...d({index:g}),label:u.title})),isOptionEqualToValue:(h,d)=>d.inputValue&&d.inputValue!==""?h.title===d.inputValue:h.title===d.title,getOptionLabel:h=>h.inputValue?h.inputValue:h.title,renderOption:(h,d,{selected:u})=>{const g=(t==null?void 0:t.some(C=>C.title===d.title))??!1;return T("li",{...h,children:[a(R,{condition:!!d.inputValue,show:a(ct,{sx:{mr:C=>C.spacing(.5)}}),elseShow:a(lt,{icon:c,checkedIcon:a(dt,{fontSize:"small"}),indeterminateIcon:a(ke,{fontSize:"small"}),sx:{mr:C=>C.spacing(.5)},checked:u&&!g,indeterminate:g})}),d.title]})},filterOptions:(h,d)=>{const u=aa(h,d),{inputValue:g}=d,C=h.some(k=>g===k.title);return g!==""&&!C&&u.push({inputValue:g,title:`Create new value "${g}"`}),u},ListboxProps:{style:{maxHeight:200,overflow:"auto"}},onChange:i,renderInput:h=>a(Ce,{...h,label:"Select values",placeholder:"Select values"}),disabled:r})},na=x("li")({flexDirection:"column"}),ya=({options:e,value:n,disabled:t=!1,onChange:o})=>{const s=Z();return a(Te,{disablePortal:!0,disabled:t,id:"tag-type-select",sx:{marginTop:r=>r.spacing(2),width:500},options:e,disableClearable:!0,value:n,getOptionLabel:r=>r.name,renderOption:(r,i)=>T(na,{...r,style:{alignItems:"flex-start",gap:s.spacing(.5)},children:[a(P,{variant:"body1",children:i.name}),a(P,{variant:"caption",children:i.description})]}),renderInput:r=>a(Ce,{...r,label:"Tag type",value:n}),onChange:o,ListboxProps:{style:{maxHeight:200,overflow:"auto"}}})},ma=()=>{const{makeRequest:e,createRequest:n,errors:t,loading:o}=pt({propagateErrors:!0});return{createTag:async i=>{const f=n("api/admin/tags",{method:"POST",body:JSON.stringify(i)});try{return await e(f.caller,f.id)}catch(p){throw p}},bulkUpdateTags:async(i,c)=>{const f=`api/admin/projects/${c}/tags`,p=n(f,{method:"PUT",body:JSON.stringify(i)});try{return await e(p.caller,p.id)}catch(l){throw l}},errors:t,loading:o}},Sa=(e,n={})=>{const t=async()=>{const p=mt(`api/admin/tags/${e}`);return(await fetch(p,{method:"GET"}).then(St("Tags"))).json()},o=`api/admin/tags/${e}`,{data:s,error:r}=ft(!!e,{tags:[]},o,t,n),[i,c]=w.useState(!r&&!s),f=()=>{yt(o)};return w.useEffect(()=>{c(!r&&!s)},[s,r]),{tags:(s==null?void 0:s.tags)||[],error:r,loading:i,refetch:f}},ba=({isStale:e,isOpen:n,projectId:t,featureId:o,onClose:s})=>{const{setToastData:r,setToastApiError:i}=I(),{patchFeatureToggle:c}=ae(),f=a(P,{children:"Setting a toggle to stale marks it for cleanup"}),p=a(P,{children:"Setting a toggle to active marks it as in active use"}),l=e?"active":"stale",y=async h=>{h.stopPropagation();try{await c(t,o,[{op:"replace",path:"/stale",value:!e}]),s()}catch(d){i(q(d))}r(e?{type:"success",title:"And we're back!",text:"The toggle is no longer marked as stale."}:{type:"success",title:"A job well done.",text:"The toggle has been marked as stale."})};return a(W,{open:n,secondaryButtonText:"Cancel",primaryButtonText:`Flip to ${l}`,title:`Set feature state to ${l}`,onClick:y,onClose:s,children:a(R,{condition:e,show:p,elseShow:f})})},sa=({ids:e,projectId:n})=>{const t=o=>`/projects/${n}/features/${o}`;return e?T(de,{severity:"warning",sx:{m:o=>o.spacing(2,0)},children:[a(P,{fontWeight:"bold",variant:"body2",display:"inline",children:`${e.length} feature toggles `}),a("span",{children:"have usage from applications. If you archive these feature toggles they will not be available to Client SDKs:"}),a("ul",{children:e==null?void 0:e.map(o=>a("li",{children:a(bt,{to:t(o),children:o})},o))})]}):null},va=({isOpen:e,onClose:n,onConfirm:t,projectId:o,featureIds:s,featuresWithUsage:r})=>{const{archiveFeatureToggle:i}=ae(),{archiveFeatures:c}=ue(),{setToastData:f,setToastApiError:p}=I(),{uiConfig:l}=K(),y=(s==null?void 0:s.length)>1;return a(W,{onClick:y?async()=>{try{await c(o,s),f({text:"Selected feature toggles have been archived",type:"success",title:"Feature toggles archived"}),t(),n()}catch(u){p(q(u)),n()}}:async()=>{try{await i(o,s[0]),f({text:"Your feature toggle has been archived",type:"success",title:"Feature archived"}),t(),n()}catch(u){p(q(u)),n()}},open:e,onClose:n,primaryButtonText:y?"Archive toggles":"Archive toggle",secondaryButtonText:"Cancel",title:y?"Archive feature toggles":"Archive feature toggle",children:a(R,{condition:y,show:T(N,{children:[T("p",{children:["Are you sure you want to archive"," ",a("strong",{children:s==null?void 0:s.length})," feature toggles?"]}),a(R,{condition:!!(l.flags.lastSeenByEnvironment&&r&&(r==null?void 0:r.length)>0),show:a(sa,{ids:r,projectId:o})}),a(R,{condition:(s==null?void 0:s.length)<=5,show:a("ul",{children:s==null?void 0:s.map(u=>a("li",{children:u},u))})})]}),elseShow:a("p",{children:"Are you sure you want to archive these feature toggles?"})})})};export{wt as C,ca as E,ua as F,ya as T,Kt as U,pa as V,ia as W,ha as a,ga as b,Sa as c,fa as d,da as e,$t as f,va as g,ba as h,Jt as i,la as j,ma as u};
